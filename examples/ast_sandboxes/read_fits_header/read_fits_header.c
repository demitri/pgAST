//
//  read_fits_header.c
//  ast_sandboxes
//
//  Created by Demitri Muna on 5/12/20.
//  Copyright Â© 2020 Demitri Muna. All rights reserved.
//

#include <stdio.h>
#include "ast.h"

#include "read_fits_header.h"

char *header = "SIM/00-visits/0001-img/07-ASPFILE = '/home/eisa4/fltops/pipe/02-vsn/50286-AIS_286/d/00-visits/0001-img/07-HKFILE  = ''                                                                    CALPATH = 'cal'                                                                 FLATFL  = 'cal/NUV_flat.fits'                                                   DTBGNDFL= ''                                                                    SPFLATFL= ''                                                                    MASKFL  = 'cal/NUV_mask.fits'                                                   SMAPVERS= '$Id: simplemap.c,v 1.173 2009/11/20 18:43:36 cmillion Exp $'         PSFFWHM = 4.5                                                                   BAND    = 1                                                                     OW      = 1                                                                     DIRECT  = 1                                                                     GRISM   = 0                                                                     OPAQUE  = 0                                                                     RA_CENT = 9.7703800201416                                                       DEC_CENT= 7.70022010803223                                                      TWIST   = -999.                                                                 GRSPA   = 325.893648464771                                                      LEG     = 2                                                                     MPSNPOS = 12                                                                    MINIVIS = 75                                                                    SUBVIS  = 75                                                                    OBJECT  = 'AIS_286_0001_sg75'                                                   EXPSTART= 1161756148.995                                                        EXPEND  = 1161756263.995                                                        OBS-DATE= '2006-10-25'                                                          TIME-OBS= '06:02:29'                                                            OBSDATIM= '061025T060229Z'                                                      OBSSECS = 1161756148.995                                                        ECLIPSE = 18627                                                                 VISIT   = 1                                                                     PLANID  = 13413                                                                 TILENUM = 50286                                                                 TILE    = 'AIS_286'                                                             TILENAME= 'AIS_286'                                                             MPSPLAN = 'ais'                                                                 MPSTYPE = 'AIS'                                                                 MPSPHASE= 'G2'                                                                  ROLL    = 195.082230252907                                                      SKYGRID = 28815                                                                 NHVNOM  = 116                                                                   NHVNOMN = 116                                                                   NHVNOMF = 116                                                                   WHICHIMS= 1863                                                                  NVALIDPH= 1990305                                                               SMNSECS = 115                                                                   SMR0    = 1.05                                                                  SMR1    = 1.3                                                                   SMNLTR0 = 2229464                                                               SMNLTR1 = 2229517                                                               SMNR0R1 = 53                                                                    SMNGTR1 = 8645                                                                  SMR8LTR0= 19386.6434782609                                                      SMR8GTR1= 75.1739130434783                                                      SMR8R0R1= 0.460869565217391                                                     GRELEASE= 'ops-v7_0_3'                                                          SCSTGREL= 'ops-v7_0_3'                                                          NDTDET  = 23.5288259571996                                                      NDTTDC  = 38.3534344311418                                                      NDTAMPA = 26.288464529761                                                       NDTAMPB = 26.1088281499928                                                      NDTCON  = 29.5597320589526                                                      ITNUVOBA= 27.2307991981506                                                      NDTHVPS = 22.6007041931152                                                      NDTLVPS = 30.3614041394201                                                      NDTDIB  = 27.923462374457                                                       NDHVMON = 5171.87828327047                                                      NDHIMON = 44.0892815425478                                                      NDSFHV  = 10.                                                                   NDCTEC  = 20060.8275862069                                                      NDCFEC  = 24041.0086206897                                                      NDCDEC  = 20060.8448275862                                                      FDTDET  = 17.0972423553467                                                      FDTTDC  = 30.2767685857312                                                      FDTAMPA = 19.1215782165527                                                      FDTAMPB = 18.3209915161133                                                      FDTCON  = 20.2110119852526                                                      ITFUVOBA= 23.9514879687079                                                      FDTHVPS = 22.3399288572114                                                      FDTLVPS = 27.7606754302979                                                      FDTDIB  = 21.4606742858887                                                      FDHVMON = 6213.268613618                                                        FDHIMON = 47.5918296945506                                                      FDSFHV  = 10.                                                                   FDCTEC  = 2151.12068965517                                                      FDCFEC  = 2327.06896551724                                                      FDCDEC  = 2151.03448275862                                                      ITM1HSHL= 5.67736668422304                                                      ITM2HUB = 26.4077559010736                                                      ITCYLBAF= 7.71354007720947                                                      NCHUNKS = 1                                                                     NRUNS   = 1.                                                                    PHTRNG0 = 1161756148.995                                                        PHTRNG1 = 1161756263.995                                                        PHTFIRST= 845791348.995                                                         PHTLAST = 845791463.995                                                         PHTELAP = 115.                                                                  EXPTIME = 109.05                                                                NGAPS   = 1.                                                                    TOTREAD = 10000000.                                                             TOTMAP  = 2113581.                                                              TOTONMAP= 1963867.                                                              NMASKED = 149714.                                                               NVISIBLE= 1963966.                                                              NSTIM1  = 2000.                                                                 STIM1X  = 0.681750361111117                                                     STIM1Y  = -0.756187583333335                                                    NSTIM2  = 1938.                                                                 STIM2X  = 0.681680999885339                                                     STIM2Y  = 0.685728557504872                                                     NSTIM3  = 2032.                                                                 STIM3X  = -0.712580421587928                                                    STIM3Y  = -0.756070374015747                                                    NSTIM4  = 1996.                                                                 STIM4X  = -0.712485303941218                                                    STIM4Y  = 0.685904016366065                                                     CNTMED  = 0.                                                                    CNTAVE  = 0.304088369283342                                                     CNTPCT1 = 0.                                                                    CNTPCT99= 2.                                                                    XNOT0AVE= 1910.95047234197                                                      YNOT0AVE= 1886.2984152445                                                       NNOT0   = 1296730.                                                              RRMED   = 87.4632186889648                                                      RRAVE   = 87.155055833776                                                       RRPCT1  = 78.645881652832                                                       RRPCT99 = 96.2120132446289                                                      NASPOK  = 114                                                                   NASPALL = 116                                                                   NASPXY  = 114                                                                   AVASPX  = 1908.30879346157                                                      AVASPY  = 1896.41655925741                                                      AVASPRRX= 477.077198365391                                                      AVASPRRY= 474.104139814352                                                      AVASPRA = 9.7755057899135                                                       AVASPDEC= 7.69018531075332                                                      AVASPROL= 195.091698078242                                                      R8INT   = 1.                                                                    NRATES  = 115                                                                   MAXRATES= 100000                                                                AVER8   = 19462.2695652174                                                      SIGR8   = 213.910553603259                                                      MINR8   = 18994.                                                                MAXR8   = 20019.                                                                AVESTMR8= 69.2695652173913                                                      SIGSTMR8= 2.8877288445215                                                       MINSTMR8= 61.                                                                   MAXSTMR8= 74.                                                                   NODEAD  = 0                                                                     NDEDHIST= 0                                                                     NDEDZERO= 0                                                                     NDEAD   = 110                                                                   AVEFDEAD= 0.0928627417345082                                                    SIGFDEAD= 0.0382205489883119                                                    MINFDEAD= 0.0303220903110831                                                    MAXFDEAD= 0.20067091228346                                                      NDEAD1  = 110                                                                   AVEFDED1= 0.0928627417345082                                                    SIGFDED1= 0.0382205489883119                                                    MINFDED1= 0.0303220903110831                                                    MAXFDED1= 0.20067091228346                                                      NDEAD2  = 0                                                                     AVEFDED2= 0.                                                                    SIGFDED2= 0.                                                                    MINFDED2= 0.                                                                    MAXFDED2= 0.                                                                    NSKIP   = 274295                                                                NSKIP00 = 0                                                                     NSKIP01 = 0                                                                     NSKIP02 = 0                                                                     NSKIP03 = 96802                                                                 NSKIP04 = 0                                                                     NSKIP05 = 19811                                                                 NSKIP06 = 0                                                                     NSKIP07 = 0                                                                     NSKIP08 = 149615                                                                NSKIP09 = 0                                                                     NSKIP10 = 7968                                                                  NSKIP11 = 99                                                                    PMEDRR  = 87.2442321777344                                                      PTHRESH = 2.                                                                    PMEDBG  = 0.00292539596557617                                                   PRMSBG  = 8.08238983154297E-05                                                  PTHRBG  = 0.00309558822382191                                                   PSIGDET = 1.87059935724435                                                      PMEDTHR = 0.00310373306274414                                                   PRMSTHR = 0.000144004821777344                                                  ";

int main() {
	
	AstFitsChan *fitschan;
	AstFrameSet *wcsinfo;
	AstFrame *frame;
	int issky;
	
	astBegin;
	
	fitschan = astFitsChan( NULL, NULL, ""); /* create an empty channel */
	astPutCards( fitschan, header ); /* add all cards at once */
	
	if (!astOK) {
		printf("An error occurred when reading the FITS header (status=%d).\n", astStatus);
	}

	/* read the WCS from the header */
	wcsinfo = astRead( fitschan );

	if (!astOK) {
		printf("An error occurred when extracting the WCS (status=%d).\n", astStatus);
	} else if (wcsinfo == AST__NULL) {
		printf("wcs is NULL\n");
		astEnd;
		return 1;
	}

	frame = astGetFrame( wcsinfo, AST__CURRENT );
	issky = astIsASkyFrame( frame );
	astAnnul( frame );
	
	printf("issky = %d\n", issky);
	
	astEnd;
	
}

